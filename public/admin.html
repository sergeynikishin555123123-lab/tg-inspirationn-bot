<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f7fafc; color: #2d3748; line-height: 1.6;
        }
        .admin-container {
            display: flex; min-height: 100vh;
        }
        .sidebar {
            width: 250px; background: #2d3748; color: white;
            padding: 20px 0; position: fixed; height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            flex: 1; margin-left: 250px; padding: 20px;
        }
        .logo {
            text-align: center; padding: 0 20px 20px; border-bottom: 1px solid #4a5568;
            margin-bottom: 20px;
        }
        .logo h1 { font-size: 18px; color: #fff; }
        .logo .subtitle { font-size: 12px; color: #a0aec0; margin-top: 5px; }
        .nav-item {
            padding: 12px 20px; color: #cbd5e0; text-decoration: none;
            display: block; transition: all 0.3s ease; border-left: 3px solid transparent;
        }
        .nav-item:hover { background: #4a5568; color: white; }
        .nav-item.active { background: #4a5568; color: white; border-left-color: #667eea; }
        .nav-section { margin-bottom: 20px; }
        .nav-section-title {
            padding: 10px 20px; color: #a0aec0; font-size: 12px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .header {
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 20px;
        }
        .stat-card {
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;
        }
        .stat-number {
            font-size: 32px; font-weight: bold; margin-bottom: 5px;
        }
        .stat-label { color: #718096; font-size: 14px; }
        .card {
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;
        }
        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0;
        }
        .card-title { font-size: 18px; font-weight: 600; }
        .btn {
            padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;
            font-size: 14px; font-weight: 600; transition: all 0.3s ease;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a67d8; }
        .btn-success { background: #48bb78; color: white; }
        .btn-success:hover { background: #38a169; }
        .btn-warning { background: #ed8936; color: white; }
        .btn-warning:hover { background: #dd6b20; }
        .btn-danger { background: #f56565; color: white; }
        .btn-danger:hover { background: #e53e3e; }
        .btn-secondary { background: #a0aec0; color: white; }
        .btn-secondary:hover { background: #718096; }
        .table-container {
            overflow-x: auto; margin-top: 15px;
        }
        table {
            width: 100%; border-collapse: collapse; background: white;
        }
        th, td {
            padding: 12px 15px; text-align: left; border-bottom: 1px solid #e2e8f0;
        }
        th { background: #f7fafc; font-weight: 600; color: #4a5568; }
        tr:hover { background: #f7fafc; }
        .badge {
            padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;
        }
        .badge-success { background: #c6f6d5; color: #276749; }
        .badge-warning { background: #feebc8; color: #dd6b20; }
        .badge-danger { background: #fed7d7; color: #c53030; }
        .badge-info { background: #bee3f8; color: #2c5aa0; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: 600; }
        .form-control {
            width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;
            font-size: 14px; transition: border-color 0.3s ease;
        }
        .form-control:focus { border-color: #667eea; outline: none; }
        .form-select { 
            width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;
            background: white; font-size: 14px;
        }
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000; align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 10px; width: 90%;
            max-width: 600px; max-height: 90vh; overflow-y: auto;
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0;
        }
        .modal-title { font-size: 20px; font-weight: 600; }
        .close { background: none; border: none; font-size: 24px; cursor: pointer; }
        .tabs {
            display: flex; background: #f7fafc; border-radius: 8px; padding: 5px;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1; padding: 10px; text-align: center; cursor: pointer;
            border-radius: 6px; transition: all 0.3s ease;
        }
        .tab.active { background: #667eea; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .loading { text-align: center; padding: 40px; color: #718096; }
        .error { background: #fed7d7; color: #c53030; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .success { background: #c6f6d5; color: #276749; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .search-box {
            display: flex; margin-bottom: 20px;
        }
        .search-input {
            flex: 1; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px 0 0 6px;
            border-right: none;
        }
        .search-btn {
            padding: 10px 20px; background: #667eea; color: white; border: none;
            border-radius: 0 6px 6px 0; cursor: pointer;
        }
        .pagination {
            display: flex; justify-content: center; margin-top: 20px;
            gap: 5px;
        }
        .page-btn {
            padding: 8px 12px; border: 1px solid #e2e8f0; background: white;
            cursor: pointer; border-radius: 4px;
        }
        .page-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .page-btn:hover:not(.active) { background: #f7fafc; }
        .action-btns { display: flex; gap: 5px; }
        .work-image {
            max-width: 100px; max-height: 100px; border-radius: 4px;
            border: 1px solid #e2e8f0; cursor: pointer;
        }
        .work-image:hover { opacity: 0.8; }
        .image-modal .modal-content { max-width: 90%; }
        .image-modal img { max-width: 100%; border-radius: 8px; }
        .filter-bar {
            display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;
        }
        .filter-select {
            padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 6px;
            background: white; min-width: 150px;
        }
        .sparks { color: #d69e2e; font-weight: bold; }
        .user-avatar {
            width: 40px; height: 40px; border-radius: 50%; background: #667eea;
            color: white; display: flex; align-items: center; justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="logo">
                <h1>üé® –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è</h1>
                <div class="subtitle">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    üìä –î–∞—à–±–æ—Ä–¥
                </a>
                <a href="#" class="nav-item" onclick="showSection('users')">
                    üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </a>
                <a href="#" class="nav-item" onclick="showSection('works')">
                    üñºÔ∏è –†–∞–±–æ—Ç—ã
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">–ö–æ–Ω—Ç–µ–Ω—Ç</div>
                <a href="#" class="nav-item" onclick="showSection('quizzes')">
                    üéØ –ö–≤–∏–∑—ã
                </a>
                <a href="#" class="nav-item" onclick="showSection('marathons')">
                    üèÉ‚Äç‚ôÇÔ∏è –ú–∞—Ä–∞—Ñ–æ–Ω—ã
                </a>
                <a href="#" class="nav-item" onclick="showSection('posts')">
                    üì∞ –ü–æ—Å—Ç—ã –∫–∞–Ω–∞–ª–∞
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">–ú–∞–≥–∞–∑–∏–Ω</div>
                <a href="#" class="nav-item" onclick="showSection('shop')">
                    üõí –¢–æ–≤–∞—Ä—ã
                </a>
                <a href="#" class="nav-item" onclick="showSection('purchases')">
                    üì¶ –ü–æ–∫—É–ø–∫–∏
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <a href="#" class="nav-item" onclick="showSection('roles')">
                    üé≠ –†–æ–ª–∏
                </a>
                <a href="#" class="nav-item" onclick="showSection('characters')">
                    üë• –ü–µ—Ä—Å–æ–Ω–∞–∂–∏
                </a>
                <a href="#" class="nav-item" onclick="showSection('system')">
                    ‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞
                </a>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="header">
                <div>
                    <h2 id="sectionTitle">–î–∞—à–±–æ—Ä–¥</h2>
                    <div style="color: #718096; font-size: 14px;" id="sectionSubtitle">
                        –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="adminInfo">
                        <div style="font-weight: 600;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        <div style="color: #718096; font-size: 14px;">–°–∏—Å—Ç–µ–º–∞</div>
                    </div>
                    <button class="btn btn-secondary" onclick="refreshAllData()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <div id="dashboardSection" class="section-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeUsers">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalWorks">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —Ä–∞–±–æ—Ç</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingWorks">0</div>
                        <div class="stat-label">–†–∞–±–æ—Ç –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuizzes">0</div>
                        <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ –∫–≤–∏–∑–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalSparks">0</div>
                        <div class="stat-label">–í—ã–¥–∞–Ω–æ –∏—Å–∫—Ä</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div id="activityChart">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üé≠ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º</div>
                        </div>
                        <div id="rolesChart">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π...</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üìä –°—Ç–∞—Ç—É—Å—ã —Ä–∞–±–æ—Ç</div>
                        </div>
                        <div id="worksStatusChart">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ä–∞–±–æ—Ç...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div id="usersSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                        <div class="search-box">
                            <input type="text" id="userSearch" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ ID...">
                            <button class="search-btn" onclick="searchUsers()">üîç</button>
                        </div>
                    </div>

                    <div class="filter-bar">
                        <select id="userRoleFilter" class="filter-select" onchange="filterUsers()">
                            <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                        </select>
                        <select id="userStatusFilter" class="filter-select" onchange="filterUsers()">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                            <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                        </select>
                        <select id="userSort" class="filter-select" onchange="filterUsers()">
                            <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                            <option value="oldest">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                            <option value="sparks">–ü–æ –∏—Å–∫—Ä–∞–º</option>
                            <option value="level">–ü–æ —É—Ä–æ–≤–Ω—é</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                    <th>–ò—Å–∫—Ä—ã</th>
                                    <th>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="8" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination" id="usersPagination">
                        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>

            <!-- –†–∞–±–æ—Ç—ã -->
            <div id="worksSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üñºÔ∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç</div>
                        <div class="tabs">
                            <div class="tab active" onclick="showWorksTab('pending')">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                            <div class="tab" onclick="showWorksTab('approved')">‚úÖ –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</div>
                            <div class="tab" onclick="showWorksTab('rejected')">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</div>
                            <div class="tab" onclick="showWorksTab('all')">üìã –í—Å–µ —Ä–∞–±–æ—Ç—ã</div>
                        </div>
                    </div>

                    <div class="filter-bar">
                        <select id="worksUserFilter" class="filter-select" onchange="filterWorks()">
                            <option value="">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                        </select>
                        <select id="worksDateFilter" class="filter-select" onchange="filterWorks()">
                            <option value="">–í—Å–µ –¥–∞—Ç—ã</option>
                            <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                            <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                            <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                        </select>
                    </div>

                    <div id="worksPendingTab" class="tab-content active">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–ê–≤—Ç–æ—Ä</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="pendingWorksBody">
                                    <tr>
                                        <td colspan="6" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="worksApprovedTab" class="tab-content">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–ê–≤—Ç–æ—Ä</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="approvedWorksBody">
                                    <!-- –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="worksRejectedTab" class="tab-content">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–ê–≤—Ç–æ—Ä</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="rejectedWorksBody">
                                    <!-- –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="worksAllTab" class="tab-content">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–ê–≤—Ç–æ—Ä</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="allWorksBody">
                                    <!-- –í—Å–µ —Ä–∞–±–æ—Ç—ã -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="pagination" id="worksPagination">
                        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>

            <!-- –ö–≤–∏–∑—ã -->
            <div id="quizzesSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–∏–∑–∞–º–∏</div>
                        <button class="btn btn-primary" onclick="showAddQuizModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–≤–∏–∑
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–í–æ–ø—Ä–æ—Å—ã</th>
                                    <th>–ù–∞–≥—Ä–∞–¥–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="quizzesTableBody">
                                <tr>
                                    <td colspan="7" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∏–∑–æ–≤...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ú–∞—Ä–∞—Ñ–æ–Ω—ã -->
            <div id="marathonsSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèÉ‚Äç‚ôÇÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∞—Ñ–æ–Ω–∞–º–∏</div>
                        <button class="btn btn-primary" onclick="showAddMarathonModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∞—Ñ–æ–Ω
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–î–Ω–∏</th>
                                    <th>–ù–∞–≥—Ä–∞–¥–∞</th>
                                    <th>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="marathonsTableBody">
                                <tr>
                                    <td colspan="7" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ü–æ—Å—Ç—ã –∫–∞–Ω–∞–ª–∞ -->
            <div id="postsSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üì∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–º–∏ –∫–∞–Ω–∞–ª–∞</div>
                        <button class="btn btn-primary" onclick="showAddPostModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–û—Ç–∑—ã–≤—ã</th>
                                    <th>–†–µ–π—Ç–∏–Ω–≥</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="postsTableBody">
                                <tr>
                                    <td colspan="7" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ú–∞–≥–∞–∑–∏–Ω -->
            <div id="shopSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üõí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</div>
                        <button class="btn btn-primary" onclick="showAddShopItemModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ü—Ä–æ–¥–∞–Ω–æ</th>
                                    <th>–î–æ—Ö–æ–¥</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="shopTableBody">
                                <tr>
                                    <td colspan="8" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–∫—É–ø–∫–∏ -->
            <div id="purchasesSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üì¶ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</div>
                    </div>

                    <div class="filter-bar">
                        <select id="purchaseItemFilter" class="filter-select" onchange="filterPurchases()">
                            <option value="">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>
                        </select>
                        <select id="purchaseUserFilter" class="filter-select" onchange="filterPurchases()">
                            <option value="">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                        </select>
                        <select id="purchaseDateFilter" class="filter-select" onchange="filterPurchases()">
                            <option value="">–í—Å–µ –¥–∞—Ç—ã</option>
                            <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                            <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                            <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–¢–æ–≤–∞—Ä</th>
                                    <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="purchasesTableBody">
                                <tr>
                                    <td colspan="6" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∫—É–ø–æ–∫...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –†–æ–ª–∏ -->
            <div id="rolesSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üé≠ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏</div>
                        <button class="btn btn-primary" onclick="showAddRoleModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ò–∫–æ–Ω–∫–∞</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="rolesTableBody">
                                <tr>
                                    <td colspan="6" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–æ–ª–µ–π...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ -->
            <div id="charactersSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏</div>
                        <button class="btn btn-primary" onclick="showAddCharacterModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="characterRoleFilter" class="filter-select" onchange="filterCharacters()">
                            <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ò–º—è</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–ë–æ–Ω—É—Å</th>
                                    <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="charactersTableBody">
                                <tr>
                                    <td colspan="7" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –°–∏—Å—Ç–µ–º–∞ -->
            <div id="systemSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:</label>
                        <input type="text" class="form-control" id="systemName" value="–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è">
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —Ä–∞–±–æ—Ç—É (–∏—Å–∫—Ä—ã):</label>
                        <input type="number" class="form-control" id="workReward" value="15">
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ (–∏—Å–∫—Ä—ã):</label>
                        <input type="number" class="form-control" id="inviteReward" value="10">
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ë–æ–Ω—É—Å –∑–∞ –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–≤–∏–∑ (%):</label>
                        <input type="number" class="form-control" id="perfectQuizBonus" value="50">
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (MB):</label>
                        <input type="number" class="form-control" id="maxFileSize" value="5">
                    </div>

                    <button class="btn btn-success" onclick="saveSystemSettings()">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üîÑ –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button class="btn btn-warning" onclick="recalculateUserStats()">
                            üìä –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        </button>
                        <button class="btn btn-warning" onclick="cleanupOldData()">
                            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
                        </button>
                        <button class="btn btn-danger" onclick="resetTestData()">
                            üß™ –°–±—Ä–æ—Å–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                        </button>
                        <button class="btn btn-danger" onclick="exportAllData()">
                            üì• –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="imageModal" class="modal image-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                <button class="close" onclick="closeModal('imageModal')">&times;</button>
            </div>
            <img id="modalImage" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã">
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                <button class="close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <form id="userForm">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label class="form-label">–ò–º—è:</label>
                    <input type="text" class="form-control" id="editUserName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–£—Ä–æ–≤–µ–Ω—å:</label>
                    <input type="number" class="form-control" id="editUserLevel" min="1" max="100" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ò—Å–∫—Ä—ã:</label>
                    <input type="number" class="form-control" id="editUserSparks" step="0.1" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–†–æ–ª—å:</label>
                    <select class="form-select" id="editUserRole" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–µ—Ä—Å–æ–Ω–∞–∂:</label>
                    <select class="form-select" id="editUserCharacter" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å:</label>
                    <select class="form-select" id="editUserStatus" required>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option value="banned">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
        </div>
    </div>

    <div id="workModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã</div>
                <button class="close" onclick="closeModal('workModal')">&times;</button>
            </div>
            <div id="workModalContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="messageArea" style="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 400px;"></div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentSection = 'dashboard';
        let currentWorksTab = 'pending';
        let currentPage = {
            users: 1,
            works: 1,
            purchases: 1
        };
        const itemsPerPage = 10;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        async function initializeAdmin() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
            await loadDashboardData();
            setupEventListeners();
            console.log('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/admin/dashboard');
                const data = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('totalUsers').textContent = data.totalUsers || 0;
                document.getElementById('activeUsers').textContent = data.activeUsers || 0;
                document.getElementById('totalWorks').textContent = data.totalWorks || 0;
                document.getElementById('pendingWorks').textContent = data.pendingWorks || 0;
                document.getElementById('totalQuizzes').textContent = data.totalQuizzes || 0;
                document.getElementById('totalSparks').textContent = data.totalSparks || 0;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
                renderActivityChart(data.activityData);
                renderRolesChart(data.rolesData);
                renderWorksStatusChart(data.worksStatusData);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞', 'error');
            }
        }

        // –†–µ–Ω–¥–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function renderActivityChart(activityData) {
            const container = document.getElementById('activityChart');
            if (!activityData || activityData.length === 0) {
                container.innerHTML = '<div class="info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }
            
            // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Chart.js)
            let html = '<div style="height: 300px; display: flex; align-items: end; gap: 10px; padding: 20px 0;">';
            const maxValue = Math.max(...activityData.map(d => d.value));
            
            activityData.forEach(day => {
                const height = (day.value / maxValue) * 250;
                html += `
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <div style="width: 30px; background: #667eea; border-radius: 4px 4px 0 0; height: ${height}px;"></div>
                        <div style="font-size: 12px; margin-top: 5px; color: #718096;">${day.date}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π
        function renderRolesChart(rolesData) {
            const container = document.getElementById('rolesChart');
            if (!rolesData || rolesData.length === 0) {
                container.innerHTML = '<div class="info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }
            
            let html = '<div style="padding: 10px 0;">';
            const total = rolesData.reduce((sum, role) => sum + role.count, 0);
            
            rolesData.forEach(role => {
                const percentage = ((role.count / total) * 100).toFixed(1);
                html += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: between; margin-bottom: 5px;">
                            <span>${role.name}</span>
                            <span style="color: #718096;">${percentage}%</span>
                        </div>
                        <div style="background: #e2e8f0; border-radius: 4px; height: 8px;">
                            <div style="background: #667eea; height: 100%; border-radius: 4px; width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ —Ä–∞–±–æ—Ç
        function renderWorksStatusChart(worksData) {
            const container = document.getElementById('worksStatusChart');
            if (!worksData || worksData.length === 0) {
                container.innerHTML = '<div class="info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }
            
            let html = '<div style="padding: 10px 0;">';
            const total = worksData.reduce((sum, status) => sum + status.count, 0);
            
            worksData.forEach(status => {
                const percentage = ((status.count / total) * 100).toFixed(1);
                const color = status.status === 'approved' ? '#48bb78' : 
                             status.status === 'pending' ? '#ed8936' : '#f56565';
                
                html += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: between; margin-bottom: 5px;">
                            <span>${getStatusText(status.status)}</span>
                            <span style="color: #718096;">${percentage}%</span>
                        </div>
                        <div style="background: #e2e8f0; border-radius: 4px; height: 8px;">
                            <div style="background: ${color}; height: 100%; border-radius: 4px; width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π
        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.section-content').forEach(section => {
                section.style.display = 'none';
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(sectionId + 'Section').style.display = 'block';
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—É–Ω–∫—Ç –º–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.textContent.includes(getSectionTitle(sectionId))) {
                    item.classList.add('active');
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('sectionTitle').textContent = getSectionTitle(sectionId);
            document.getElementById('sectionSubtitle').textContent = getSectionSubtitle(sectionId);
            
            currentSection = sectionId;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏
            loadSectionData(sectionId);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–∫—Ü–∏–∏
        async function loadSectionData(sectionId) {
            switch(sectionId) {
                case 'users':
                    await loadUsers();
                    break;
                case 'works':
                    await loadWorks();
                    break;
                case 'quizzes':
                    await loadQuizzes();
                    break;
                case 'marathons':
                    await loadMarathons();
                    break;
                case 'posts':
                    await loadPosts();
                    break;
                case 'shop':
                    await loadShopItems();
                    break;
                case 'purchases':
                    await loadPurchases();
                    break;
                case 'roles':
                    await loadRoles();
                    break;
                case 'characters':
                    await loadCharacters();
                    break;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers(page = 1) {
            try {
                const response = await fetch(`/api/admin/users?page=${page}&limit=${itemsPerPage}`);
                const data = await response.json();
                
                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = '';
                
                if (data.users && data.users.length > 0) {
                    data.users.forEach(user => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${user.id}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="user-avatar">${user.tg_first_name ? user.tg_first_name[0].toUpperCase() : 'U'}</div>
                                    <div>
                                        <div style="font-weight: 600;">${user.tg_first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                        <div style="color: #718096; font-size: 12px;">@${user.tg_username || '–±–µ–∑ username'}</div>
                                    </div>
                                </div>
                            </td>
                            <td>${user.class || '–ù–µ –≤—ã–±—Ä–∞–Ω–∞'}</td>
                            <td>${user.level}</td>
                            <td class="sparks">${user.sparks.toFixed(1)}‚ú®</td>
                            <td>${new Date(user.last_activity).toLocaleDateString('ru-RU')}</td>
                            <td>
                                <span class="badge ${user.is_active ? 'badge-success' : 'badge-danger'}">
                                    ${user.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                                </span>
                            </td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn btn-secondary" onclick="editUser(${user.id})">‚úèÔ∏è</button>
                                    <button class="btn btn-warning" onclick="viewUserActivities(${user.id})">üìä</button>
                                    <button class="btn btn-danger" onclick="deleteUser(${user.id})">üóëÔ∏è</button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                    
                    renderPagination('usersPagination', page, data.totalPages, 'loadUsers');
                } else {
                    tbody.innerHTML = '<tr><td colspan="8" class="info">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>';
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                await loadUserFilters();
                
            } catch (error) {
                document.getElementById('usersTableBody').innerHTML = '<tr><td colspan="8" class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td></tr>';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç
        async function loadWorks() {
            try {
                const response = await fetch(`/api/admin/works?status=${currentWorksTab}&page=${currentPage.works}&limit=${itemsPerPage}`);
                const data = await response.json();
                
                const bodies = {
                    'pending': 'pendingWorksBody',
                    'approved': 'approvedWorksBody',
                    'rejected': 'rejectedWorksBody',
                    'all': 'allWorksBody'
                };
                
                Object.keys(bodies).forEach(tab => {
                    const tbody = document.getElementById(bodies[tab]);
                    if (tbody) {
                        tbody.innerHTML = '';
                    }
                });
                
                if (data.works && data.works.length > 0) {
                    data.works.forEach(work => {
                        const statusBadge = work.status === 'approved' ? 'badge-success' : 
                                          work.status === 'pending' ? 'badge-warning' : 'badge-danger';
                        const statusText = work.status === 'approved' ? '–û–¥–æ–±—Ä–µ–Ω–æ' : 
                                         work.status === 'pending' ? '–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏' : '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ';
                        
                        const row = `
                            <tr>
                                <td>${work.id}</td>
                                <td>
                                    <img src="${work.image_url}" class="work-image" onclick="viewImage('${work.image_url}')">
                                </td>
                                <td>
                                    <div style="font-weight: 600;">${work.title}</div>
                                    ${work.description ? `<div style="color: #718096; font-size: 12px;">${work.description}</div>` : ''}
                                </td>
                                <td>
                                    <div style="font-weight: 600;">${work.user_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                    <div style="color: #718096; font-size: 12px;">ID: ${work.user_id}</div>
                                </td>
                                <td>${new Date(work.created_at).toLocaleDateString('ru-RU')}</td>
                                ${currentWorksTab === 'approved' ? `<td>${work.moderated_by || '–°–∏—Å—Ç–µ–º–∞'}</td>` : ''}
                                ${currentWorksTab === 'rejected' ? `<td>${work.admin_comment || '–ü—Ä–∏—á–∏–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</td>` : ''}
                                ${currentWorksTab === 'all' ? `<td><span class="badge ${statusBadge}">${statusText}</span></td>` : ''}
                                <td>
                                    <div class="action-btns">
                                        ${work.status === 'pending' ? `
                                            <button class="btn btn-success" onclick="approveWork(${work.id})">‚úÖ</button>
                                            <button class="btn btn-danger" onclick="rejectWork(${work.id})">‚ùå</button>
                                        ` : ''}
                                        <button class="btn btn-secondary" onclick="viewWorkDetails(${work.id})">üëÅÔ∏è</button>
                                        <button class="btn btn-warning" onclick="editWork(${work.id})">‚úèÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        `;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É
                        if (currentWorksTab === 'all') {
                            document.getElementById('allWorksBody').innerHTML += row;
                        } else {
                            document.getElementById(bodies[currentWorksTab]).innerHTML += row;
                        }
                    });
                    
                    renderPagination('worksPagination', currentPage.works, data.totalPages, 'loadWorksPage');
                } else {
                    const noDataMsg = '<tr><td colspan="7" class="info">–†–∞–±–æ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>';
                    document.getElementById(bodies[currentWorksTab]).innerHTML = noDataMsg;
                }
                
            } catch (error) {
                const errorMsg = '<tr><td colspan="7" class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–±–æ—Ç</td></tr>';
                document.getElementById('pendingWorksBody').innerHTML = errorMsg;
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ —Ä–∞–±–æ—Ç
        function showWorksTab(tab) {
            currentWorksTab = tab;
            currentPage.works = 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => {
                if (t.textContent.includes(
                    tab === 'pending' ? '–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏' :
                    tab === 'approved' ? '–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ' :
                    tab === 'rejected' ? '–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ' : '–í—Å–µ —Ä–∞–±–æ—Ç—ã'
                )) {
                    t.classList.add('active');
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('works' + capitalizeFirst(tab) + 'Tab').classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadWorks();
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getSectionTitle(sectionId) {
            const titles = {
                'dashboard': '–î–∞—à–±–æ—Ä–¥',
                'users': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                'works': '–†–∞–±–æ—Ç—ã',
                'quizzes': '–ö–≤–∏–∑—ã',
                'marathons': '–ú–∞—Ä–∞—Ñ–æ–Ω—ã',
                'posts': '–ü–æ—Å—Ç—ã –∫–∞–Ω–∞–ª–∞',
                'shop': '–ú–∞–≥–∞–∑–∏–Ω',
                'purchases': '–ü–æ–∫—É–ø–∫–∏',
                'roles': '–†–æ–ª–∏',
                'characters': '–ü–µ—Ä—Å–æ–Ω–∞–∂–∏',
                'system': '–°–∏—Å—Ç–µ–º–∞'
            };
            return titles[sectionId] || sectionId;
        }

        function getSectionSubtitle(sectionId) {
            const subtitles = {
                'dashboard': '–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞',
                'users': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã',
                'works': '–ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–∞–±–æ—Ç',
                'quizzes': '–°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–∏–∑–∞–º–∏',
                'marathons': '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤',
                'posts': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∫–∞–Ω–∞–ª–∞',
                'shop': '–¢–æ–≤–∞—Ä—ã –∏ —Ü–µ–Ω—ã –º–∞–≥–∞–∑–∏–Ω–∞',
                'purchases': '–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                'roles': '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                'characters': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –∏ –±–æ–Ω—É—Å–∞–º–∏',
                'system': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏'
            };
            return subtitles[sectionId] || '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–º';
        }

        function getStatusText(status) {
            const statuses = {
                'pending': '–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏',
                'approved': '–û–¥–æ–±—Ä–µ–Ω–æ',
                'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
            };
            return statuses[status] || status;
        }

        function capitalizeFirst(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function showMessage(message, type = 'info') {
            const messageArea = document.getElementById('messageArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error' : 
                                 type === 'success' ? 'success' : 'info';
            messageDiv.style.marginBottom = '10px';
            messageDiv.textContent = message;
            messageArea.appendChild(messageDiv);
            
            setTimeout(() => messageDiv.remove(), 5000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function viewImage(imageUrl) {
            document.getElementById('modalImage').src = imageUrl;
            document.getElementById('imageModal').style.display = 'flex';
        }

        function refreshAllData() {
            loadDashboardData();
            if (currentSection !== 'dashboard') {
                loadSectionData(currentSection);
            }
            showMessage('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'success');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initializeAdmin);

        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (—Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)
        async function loadUserFilters() { /* ... */ }
        async function loadQuizzes() { /* ... */ }
        async function loadMarathons() { /* ... */ }
        async function loadPosts() { /* ... */ }
        async function loadShopItems() { /* ... */ }
        async function loadPurchases() { /* ... */ }
        async function loadRoles() { /* ... */ }
        async function loadCharacters() { /* ... */ }
        function renderPagination(containerId, currentPage, totalPages, callback) { /* ... */ }
        function editUser(userId) { /* ... */ }
        function viewUserActivities(userId) { /* ... */ }
        function deleteUser(userId) { /* ... */ }
        function approveWork(workId) { /* ... */ }
        function rejectWork(workId) { /* ... */ }
        function viewWorkDetails(workId) { /* ... */ }
        function editWork(workId) { /* ... */ }
        function showAddQuizModal() { /* ... */ }
        function showAddMarathonModal() { /* ... */ }
        function showAddPostModal() { /* ... */ }
        function showAddShopItemModal() { /* ... */ }
        function showAddRoleModal() { /* ... */ }
        function showAddCharacterModal() { /* ... */ }
        function saveSystemSettings() { /* ... */ }
        function recalculateUserStats() { /* ... */ }
        function cleanupOldData() { /* ... */ }
        function resetTestData() { /* ... */ }
        function exportAllData() { /* ... */ }
        function setupEventListeners() { /* ... */ }

    </script>
</body>
</html>
